
> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

‚úÖ WebSocket Server created successfully
WebSocket server initialized
12:58:23 AM [express] serving on port 3001
üîÑ Bulk upload request received
üì¶ Request body: {
  "shops": [
    {
      "shop_name": "Test Bakery",
      "shop_category": "Food",
      "location": "123 Test Street, Test City",
      "phone": "+1-555-TEST",
      "hours": "Mon-Fri: 8AM-6PM",
      "business_email": "contact@testbakery.com",
      "website": "https://testbakery.com",
      "about_shop": "A cozy neighborhood bakery",
      "owner_name": "Test Owner",
      "owner_email": "owner@testbakery.com"
    }
  ],
  "products": [
    {
      "shop_id": "test_bakery",
      "product_name": "Fresh Bread",
      "price": "5.99",
      "description": "Freshly baked daily",
      "stock": "10",
      "image_url": "https://example.com/bread.jpg"
    },
    {
      "shop_id": "test_bakery",
      "product_name": "Chocolate Cake",
      "price": "25.99",
      "description": "Delicious chocolate cake",
      "stock": "5",
      "image_url": "https://example.com/cake.jpg"
    }
  ]
}
‚úÖ Processing 1 shops and 2 products
üîÑ Starting database transaction
üè™ Processing shop: Test Bakery
üè™ Shop object to insert: {
  "id": "BC6Xve8NLULk7PzPWHKZI",
  "name": "Test Bakery",
  "category": "Food",
  "location": "123 Test Street, Test City",
  "phone": "+1-555-TEST",
  "hours": "Mon-Fri: 8AM-6PM",
  "business_email": "contact@testbakery.com",
  "website": "https://testbakery.com",
  "social_links": null,
  "about_shop": "A cozy neighborhood bakery",
  "shop_photo": null,
  "status": "approved",
  "owner_id": "F6-pqokvUaEN7sc0G1G79",
  "submitted_at": 1750793316227,
  "approved_at": 1750793316227,
  "rejected_at": null,
  "rejection_reason": null,
  "created_at": 1750793316227,
  "updated_at": 1750793316227
}
‚ùå Error in bulk upload: TypeError: Transaction function cannot return a promise
    at Function.sqliteTransaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/better-sqlite3/lib/methods/transaction.js:67:10)
    at BetterSQLiteSession.transaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/src/better-sqlite3/session.ts:68:48)
    at BetterSQLite3Database.transaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/src/sqlite-core/db.ts:589:23)
    at <anonymous> (/Users/amitesh/work/localpickup/localpick-market-demo/server/routes/shops.ts:201:16)
    at Layer.handle [as handle_request] (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/layer.js:95:5)
    at /Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/index.js:346:12)
‚ùå Error stack: TypeError: Transaction function cannot return a promise
    at Function.sqliteTransaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/better-sqlite3/lib/methods/transaction.js:67:10)
    at BetterSQLiteSession.transaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/src/better-sqlite3/session.ts:68:48)
    at BetterSQLite3Database.transaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/src/sqlite-core/db.ts:589:23)
    at <anonymous> (/Users/amitesh/work/localpickup/localpick-market-demo/server/routes/shops.ts:201:16)
    at Layer.handle [as handle_request] (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/layer.js:95:5)
    at /Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/index.js:346:12)
12:58:36 AM [express] POST /api/shops/bulk-upload 500 in 7ms :: {"error":"Failed to upload shops and ‚Ä¶
‚úÖ Shop created successfully: Test Bakery
üì¶ Processing product: Fresh Bread
üì¶ Product object to insert: {
  "id": "DdWu1Lbmnur-8Cv45J3Ry",
  "shop_id": "BC6Xve8NLULk7PzPWHKZI",
  "name": "Fresh Bread",
  "image": "https://example.com/bread.jpg",
  "price": 5.99,
  "description": "Freshly baked daily",
  "stock": 10,
  "is_archived": false,
  "created_at": 1750793316241,
  "updated_at": 1750793316241
}
‚úÖ Product created successfully: Fresh Bread
üì¶ Processing product: Chocolate Cake
üì¶ Product object to insert: {
  "id": "Qnz52r-bATqjPxm_MfuKS",
  "shop_id": "BC6Xve8NLULk7PzPWHKZI",
  "name": "Chocolate Cake",
  "image": "https://example.com/cake.jpg",
  "price": 25.99,
  "description": "Delicious chocolate cake",
  "stock": 5,
  "is_archived": false,
  "created_at": 1750793316244,
  "updated_at": 1750793316244
}
‚úÖ Product created successfully: Chocolate Cake
üîÑ Bulk upload request received
üì¶ Request body: {
  "shops": [
    {
      "shop_name": "Working Test",
      "shop_category": "Food",
      "location": "Test Location",
      "hours": "9-5"
    }
  ],
  "products": [
    {
      "shop_id": "working_test",
      "product_name": "Test Product",
      "price": "10.00",
      "description": "Test",
      "stock": "5"
    }
  ]
}
‚úÖ Processing 1 shops and 1 products
üîÑ Starting database transaction
üè™ Processing shop: Working Test
üè™ Shop object to insert: {
  "id": "oj9LlbmojfCWKzu8RGFe-",
  "name": "Working Test",
  "category": "Food",
  "location": "Test Location",
  "phone": null,
  "hours": "9-5",
  "business_email": null,
  "website": null,
  "social_links": null,
  "about_shop": null,
  "shop_photo": null,
  "status": "approved",
  "owner_id": "PPLo_AVcvCXV2wgPzB4Xt",
  "submitted_at": 1750793358334,
  "approved_at": 1750793358334,
  "rejected_at": null,
  "rejection_reason": null,
  "created_at": 1750793358334,
  "updated_at": 1750793358334
}
‚ùå Error in bulk upload: TypeError: Transaction function cannot return a promise
    at Function.sqliteTransaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/better-sqlite3/lib/methods/transaction.js:67:10)
    at BetterSQLiteSession.transaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/src/better-sqlite3/session.ts:68:48)
    at BetterSQLite3Database.transaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/src/sqlite-core/db.ts:589:23)
    at <anonymous> (/Users/amitesh/work/localpickup/localpick-market-demo/server/routes/shops.ts:201:16)
    at Layer.handle [as handle_request] (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/layer.js:95:5)
    at /Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/index.js:346:12)
‚ùå Error stack: TypeError: Transaction function cannot return a promise
    at Function.sqliteTransaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/better-sqlite3/lib/methods/transaction.js:67:10)
    at BetterSQLiteSession.transaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/src/better-sqlite3/session.ts:68:48)
    at BetterSQLite3Database.transaction (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/src/sqlite-core/db.ts:589:23)
    at <anonymous> (/Users/amitesh/work/localpickup/localpick-market-demo/server/routes/shops.ts:201:16)
    at Layer.handle [as handle_request] (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/layer.js:95:5)
    at /Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/amitesh/work/localpickup/localpick-market-demo/node_modules/express/lib/router/index.js:346:12)
12:59:18 AM [express] POST /api/shops/bulk-upload 500 in 2ms :: {"error":"Failed to upload shops and ‚Ä¶
‚úÖ Shop created successfully: Working Test
üì¶ Processing product: Test Product
üì¶ Product object to insert: {
  "id": "yGXZEbdvoB2und5U9Pyff",
  "shop_id": "oj9LlbmojfCWKzu8RGFe-",
  "name": "Test Product",
  "image": "/placeholder.svg",
  "price": 10,
  "description": "Test",
  "stock": 5,
  "is_archived": false,
  "created_at": 1750793358341,
  "updated_at": 1750793358341
}
‚úÖ Product created successfully: Test Product
